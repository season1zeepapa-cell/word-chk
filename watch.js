// ========================================
// ðŸ”„ íŒŒì¼ ê°ì‹œ ë° ì„œë²„ ì‹¤í–‰ í†µí•© ìŠ¤í¬ë¦½íŠ¸
// ========================================
// ì„¤ëª…: ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‘ ê°€ì§€ ìž‘ì—…ì„ ë™ì‹œì— ìˆ˜í–‰í•©ë‹ˆë‹¤
//       1. profile í´ë”ì˜ .txt íŒŒì¼ ë³€ê²½ ê°ì§€ ë° ìžë™ ë¹Œë“œ
//       2. ë¡œì»¬ ì›¹ ì„œë²„ ì‹¤í–‰

const { spawn } = require('child_process');

console.log('ðŸš€ ê°œë°œ í™˜ê²½ì„ ì‹œìž‘í•©ë‹ˆë‹¤...\n');

// ========================================
// ðŸŒ Python ì›¹ ì„œë²„ ì‹¤í–‰
// ========================================
console.log('ðŸŒ ì›¹ ì„œë²„ ì‹œìž‘ ì¤‘... (í¬íŠ¸ 3001)');
const server = spawn('python3', ['-m', 'http.server', '3001'], {
    stdio: 'inherit' // ì„œë²„ ë¡œê·¸ë¥¼ ê·¸ëŒ€ë¡œ ì¶œë ¥
});

// ========================================
// ðŸ‘€ Nodemonìœ¼ë¡œ íŒŒì¼ ê°ì‹œ ì‹œìž‘
// ========================================
console.log('ðŸ‘€ profile í´ë” ê°ì‹œ ì‹œìž‘...');
console.log('ðŸ“ http://localhost:3001 ì—ì„œ í™•ì¸í•˜ì„¸ìš”\n');

const watcher = spawn('npx', [
    'nodemon',
    '--watch', 'profile',
    '--ext', 'txt',
    '--exec', 'node generate-files.js && echo "âœ… files.json ì—…ë°ì´íŠ¸ ì™„ë£Œ! ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”."'
], {
    stdio: 'inherit' // Nodemon ë¡œê·¸ë¥¼ ê·¸ëŒ€ë¡œ ì¶œë ¥
});

// ========================================
// ðŸ›‘ ì¢…ë£Œ ì²˜ë¦¬
// ========================================
// ì„¤ëª…: Ctrl+Cë¥¼ ëˆ„ë¥´ë©´ ë‘ í”„ë¡œì„¸ìŠ¤ë¥¼ ëª¨ë‘ ì¢…ë£Œí•©ë‹ˆë‹¤
process.on('SIGINT', () => {
    console.log('\n\nðŸ‘‹ ê°œë°œ ì„œë²„ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤...');
    server.kill();
    watcher.kill();
    process.exit();
});
